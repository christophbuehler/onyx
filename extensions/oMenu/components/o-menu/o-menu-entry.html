<dom-module id="o-menu-entry">
  <style>
  .menu-title { text-align: left; font-size: 22px; letter-spacing: 2px; color: var(--main-color); font-weight: 600; margin: 16px; }
  </style>
  <template>
    <li on-tap="liTap" class$="{{getClass(active, opened)}}">
      <template is="dom-if" if="{{isLink(sub, preventParentLink)}}">
        <a>{{title}}</a>
      </template>
      <template is="dom-if" if="{{!isLink(sub, preventParentLink)}}">
        <a href="#{{path}}/{{route}}">{{title}}</a>
      </template>

      <template is="dom-if" if="{{hasEntries(sub)}}">
        <ul>
          <!-- display parent -->
          <template is="dom-if" if="{{hasParentTitle}}">
            <div class="menu-title">{{title}}</div>
          </template>

          <template is="dom-repeat" items="{{sub}}">
            <template is="dom-if" if="{{hasChildren(item)}}">
              <o-menu-entry title="{{item.0}}" path="{{route}}" route="{{item.1}}" sub="{{item.2}}" prevent-parent-link="{{preventParentLink}}"></o-menu-entry>
            </template>
            <template is="dom-if" if="{{!hasChildren(item)}}">
              <o-menu-entry a="{{a}}"
                title="{{item.0}}"
                path="{{route}}"
                route="{{item.1}}"
                has-parent-title="{{hasParentTitle}}"
                prevent-parent-link="{{preventParentLink}}"></o-menu-entry>
            </template>
          </template>

          <!-- display back link -->
          <template is="dom-if" if="{{hasBackLink}}">
            <div on-tap="backLinkTap" class="back-link">
              <span class="material-icons">keyboard_backspace</span><span class="text">&nbsp;zur√ºck</span>
            </div>
          </template>
        </ul>
      </template>

      <template is="dom-if" if="{{hasChildren(sub)}}">
        <!-- <div on-click="toggle" class="subMenuBtn"><div class="a"></div><div class="b"></div><div class="c"></div></div> -->
      </template>
    </li>
  </template>
  <script>
  Polymer({
    is: 'o-menu-entry',
    properties: {
      /**
       * Include a back link for sub entries.
       */
      hasBackLink: {
        type: Boolean,
        value: false
      },

      /**
       * Display the parent of this entry as a title.
       */
      hasParentTitle: {
        type: Boolean,
        value: false
      },

      /**
       * Abort navigation if the element has children.
       */
      preventParentLink: {
        type: Boolean,
        value: false
      },

      path: {
        type: String,
        value: ''
      },
      route: String,
      title: String,
      sub: {
        type: Array,
        value: []
      },
      active: {
        type: Boolean,
        value: false
      },
      opened: {
        type: Boolean,
        value: false
      },
      oMenu: Object
    },
    ready: function() {
      this.canOpen = true;
    },
    getClass: function(active, opened) {
      var arr = [];
      if (active) arr.push('active');
      if (opened) arr.push('opened');
      return arr.join(' ');
    },
    hasEntries: function(entries) {
      return entries.length > 0;
    },
    update: function(route, pageTitle, open) {
      if (this.route != route[0]) return false;

      this.active = true;
      if (open) this.opened = true;
      route.splice(0, 1);

      pageTitle.push({
        url: this.path + '/' + this.route,
        caption: this.title
      });

      $('o-menu-entry').each(function() {
        if (this.update(route, pageTitle, open)) return false;
      });

      return true;
    },

    isLink: function(sub, preventParentLink) {
      return sub.length > 0 && preventParentLink;
    },

    hasChildren: function(item) {
      return item.length > 2;
    },

    // clicked on a back link
    backLinkTap: function() {
        this.canOpen = false;

        // close the parent li element
        this.opened = false;
    },

    liTap: function() {

      // this entry is currently opened
      if (this.opened) {

        // we have a back link
        if (this.hasBackLink) return;

        this.opened = false;
        return;
      }

      if (!this.canOpen) {
        this.canOpen = true;
        return;
      }

      $(this.oMenu).find('o-menu-entry').opened = false;
      this.opened = true;
    }
  });
  </script>
</dom-module>
